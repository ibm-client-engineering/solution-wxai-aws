"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[8377],{1733:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>o,contentTitle:()=>r,default:()=>h,frontMatter:()=>i,metadata:()=>a,toc:()=>c});var l=n(5893),s=n(1151);const i={id:"installation",sidebar_position:3,title:"Installation",custom_edit_url:null},r=void 0,a={id:"GettingStarted/installation",title:"Installation",description:"Installation Steps",source:"@site/docs/1-GettingStarted/3-Installation.mdx",sourceDirName:"1-GettingStarted",slug:"/GettingStarted/installation",permalink:"/solution-wxai-aws/GettingStarted/installation",draft:!1,unlisted:!1,editUrl:null,tags:[],version:"current",sidebarPosition:3,frontMatter:{id:"installation",sidebar_position:3,title:"Installation",custom_edit_url:null},sidebar:"tutorialSidebar",previous:{title:"Prerequisites",permalink:"/solution-wxai-aws/GettingStarted/prerequisites"},next:{title:"Lessons Learned",permalink:"/solution-wxai-aws/GettingStarted/4-Lessons"}},o={},c=[{value:"Installation Steps",id:"installation-steps",level:2},{value:"Preparing",id:"preparing",level:3},{value:"Obtain the AWS IAM credentials",id:"obtain-the-aws-iam-credentials",level:4},{value:"Configure AWS config",id:"configure-aws-config",level:4},{value:"Redhat pull secret",id:"redhat-pull-secret",level:4},{value:"Create s3 bucket",id:"create-s3-bucket",level:4},{value:"Create pull-secrets folder in s3 bucket",id:"create-pull-secrets-folder-in-s3-bucket",level:4},{value:"Upload pull-secrets.json to s3bucket/pull-secrets",id:"upload-pull-secretsjson-to-s3bucketpull-secrets",level:4},{value:"Create AWS KeyPair",id:"create-aws-keypair",level:4},{value:"Prepare",id:"prepare",level:3},{value:"Preparing the installion files",id:"preparing-the-installion-files",level:4},{value:"Preparing Parameters Override file",id:"preparing-parameters-override-file",level:4},{value:"Deployment",id:"deployment",level:3},{value:"Create OCPInstall Role",id:"create-ocpinstall-role",level:4},{value:"Create LambdaExecution Role",id:"create-lambdaexecution-role",level:4},{value:"Deply cloudformation template using AWS CLI",id:"deply-cloudformation-template-using-aws-cli",level:4},{value:"Monitor",id:"monitor",level:3},{value:"SSH into bootnode",id:"ssh-into-bootnode",level:4},{value:"Monitor the deployment",id:"monitor-the-deployment",level:4}];function d(e){const t={a:"a",br:"br",code:"code",em:"em",h2:"h2",h3:"h3",h4:"h4",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.a)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(t.h2,{id:"installation-steps",children:"Installation Steps"}),"\n",(0,l.jsx)(t.h3,{id:"preparing",children:"Preparing"}),"\n",(0,l.jsx)(t.h4,{id:"obtain-the-aws-iam-credentials",children:"Obtain the AWS IAM credentials"}),"\n",(0,l.jsxs)(t.p,{children:["If you can use your permanent security credentials for the AWS account, you will need an ",(0,l.jsx)(t.strong,{children:"Access Key ID"})," and ",(0,l.jsx)(t.strong,{children:"Secret Access Key"})," for the deployer to setup an OpenShift cluster on AWS."]}),"\n",(0,l.jsxs)(t.ul,{children:["\n",(0,l.jsxs)(t.li,{children:["Go to ",(0,l.jsx)(t.a,{href:"https://aws.amazon.com/",children:"https://aws.amazon.com/"})]}),"\n",(0,l.jsx)(t.li,{children:"Login to the AWS console"}),"\n",(0,l.jsx)(t.li,{children:"Click on your user name at the top right of the screen"}),"\n",(0,l.jsxs)(t.li,{children:["Select ",(0,l.jsx)(t.strong,{children:"Security credentials"}),". You can also reach this screen via ",(0,l.jsx)(t.a,{href:"https://console.aws.amazon.com/iam/home?region=us-east-2#/security_credentials",children:"https://console.aws.amazon.com/iam/home?region=us-east-2#/security_credentials"}),"."]}),"\n",(0,l.jsx)(t.li,{children:"If you do not yet have an access key (or you no longer have the associated secret), create an access key"}),"\n",(0,l.jsxs)(t.li,{children:["Store your ",(0,l.jsx)(t.strong,{children:"Access Key ID"})," and ",(0,l.jsx)(t.strong,{children:"Secret Access Key"})," in safe place"]}),"\n"]}),"\n",(0,l.jsx)(t.h4,{id:"configure-aws-config",children:"Configure AWS config"}),"\n",(0,l.jsx)(t.p,{children:"Run the following command and then enter your Access Key ID, Secret Access Key, Region, and Output."}),"\n",(0,l.jsx)(t.pre,{children:(0,l.jsx)(t.code,{children:"aws configure\n"})}),"\n",(0,l.jsx)(t.h4,{id:"redhat-pull-secret",children:"Redhat pull secret"}),"\n",(0,l.jsxs)(t.p,{children:["The Red Hat pull secret must be downloaded from ",(0,l.jsx)(t.a,{href:"https://console.redhat.com/openshift/downloads#tool-pull-secret",children:"https://console.redhat.com/openshift/downloads#tool-pull-secret"}),".\nRename the file from ",(0,l.jsx)(t.code,{children:"pull-secret.txt"})," to ",(0,l.jsx)(t.code,{children:"pull_secret.json"})]}),"\n",(0,l.jsx)(t.h4,{id:"create-s3-bucket",children:"Create s3 bucket"}),"\n",(0,l.jsx)(t.pre,{children:(0,l.jsx)(t.code,{children:'BUCKET="Bucket_NAME"\naws s3api create-bucket --bucket $BUCKET --region us-east-1\n'})}),"\n",(0,l.jsx)(t.h4,{id:"create-pull-secrets-folder-in-s3-bucket",children:"Create pull-secrets folder in s3 bucket"}),"\n",(0,l.jsx)(t.pre,{children:(0,l.jsx)(t.code,{children:'aws s3api put-object --bucket $BUCKET --key "pull-secets" --region us-east-1\n'})}),"\n",(0,l.jsx)(t.h4,{id:"upload-pull-secretsjson-to-s3bucketpull-secrets",children:"Upload pull-secrets.json to s3bucket/pull-secrets"}),"\n",(0,l.jsx)(t.pre,{children:(0,l.jsx)(t.code,{children:"aws s3 cp pull-secrets.json s3://$BUCKET/pull-secrets/pull-secrets.json\n"})}),"\n",(0,l.jsx)(t.h4,{id:"create-aws-keypair",children:"Create AWS KeyPair"}),"\n",(0,l.jsx)(t.p,{children:"The following commands create the KeyPair, outputs the file to the default ssh folder. The second command modifies the permissions of the file."}),"\n",(0,l.jsx)(t.pre,{children:(0,l.jsx)(t.code,{children:'aws ec2 create-key-pair  --key-name $KEYPAIR_NAME --key-type rsa --key-format pem --query "KeyMaterial" --output text > ~/.ssh/$KEYPAIR_NAME.pem\nchmod 400 ~/.ssh/$KEYPAIR_NAME.pem\n'})}),"\n",(0,l.jsx)(t.h3,{id:"prepare",children:"Prepare"}),"\n",(0,l.jsx)(t.h4,{id:"preparing-the-installion-files",children:"Preparing the installion files"}),"\n",(0,l.jsxs)(t.p,{children:['The default "AvailabilityZones" in ',(0,l.jsx)(t.em,{children:(0,l.jsx)(t.strong,{children:"clusters.yaml"})})," are ",(0,l.jsx)(t.strong,{children:'"us-east-2a,us-east-2b,us-east-2c"'})," but can be changed.",(0,l.jsx)(t.br,{}),"\n","To change which Availability Zones are used, search ",(0,l.jsx)(t.em,{children:(0,l.jsx)(t.strong,{children:"clusters.yaml"})})," for ",(0,l.jsx)(t.code,{children:"us-east-2a,us-east-2b,us-east-2c"})," and replace with the preferred Availability Zones.",(0,l.jsx)(t.br,{}),"\n","Search ",(0,l.jsx)(t.em,{children:(0,l.jsx)(t.strong,{children:"clusters.yaml"})})," for ",(0,l.jsx)(t.code,{children:"REPLACE_ME_WITH_SUBNET_ID"})," and replace with a specific subnetID."]}),"\n",(0,l.jsx)(t.h4,{id:"preparing-parameters-override-file",children:"Preparing Parameters Override file"}),"\n",(0,l.jsxs)(t.p,{children:["Review ",(0,l.jsx)(t.em,{children:(0,l.jsx)(t.strong,{children:'"parameters-override.yaml"'})}),", the following changes will need to be made"]}),"\n",(0,l.jsxs)(t.ul,{children:["\n",(0,l.jsx)(t.li,{children:"Add API Key"}),"\n",(0,l.jsx)(t.li,{children:"Add KeyPairName"}),"\n",(0,l.jsx)(t.li,{children:"Add Private Subnets"}),"\n",(0,l.jsx)(t.li,{children:"Add Public Subnets"}),"\n",(0,l.jsx)(t.li,{children:"Add Red Hat Pull Secret s3 location"}),"\n",(0,l.jsx)(t.li,{children:"Add VPC ID"}),"\n",(0,l.jsx)(t.li,{children:"Add Bucket Name for s3 bucket that is being used by Red Hat Pull secret"}),"\n",(0,l.jsx)(t.li,{children:"Add Domain Name"}),"\n",(0,l.jsx)(t.li,{children:"Add Cluster Name"}),"\n",(0,l.jsx)(t.li,{children:"Add CPD External Registry"}),"\n"]}),"\n",(0,l.jsx)(t.h3,{id:"deployment",children:"Deployment"}),"\n",(0,l.jsx)(t.h4,{id:"create-ocpinstall-role",children:"Create OCPInstall Role"}),"\n",(0,l.jsxs)(t.p,{children:[(0,l.jsx)(t.a,{href:"https://github.com/ibm-client-engineering/solution-wxai-aws/assets/Cloudformation/OCPInstall_Role.yaml",children:"Download the OCPInstall_Role.yaml"}),"\nCreate the role by running the following command:"]}),"\n",(0,l.jsx)(t.pre,{children:(0,l.jsx)(t.code,{children:"aws cloudformation deploy --stack-name OCPInstall-role-1 -template-file OCPInstall_Role.yaml --capabilities CAPABILITY_NAMED_IAM --tags *add Key=Value tag here*\n"})}),"\n",(0,l.jsx)(t.h4,{id:"create-lambdaexecution-role",children:"Create LambdaExecution Role"}),"\n",(0,l.jsxs)(t.p,{children:[(0,l.jsx)(t.a,{href:"https://github.com/ibm-client-engineering/solution-wxai-aws/assets/Cloudformation/LambdaExecutionRole.yaml",children:"Download the LambdaExecutionRole.yaml"}),"\nCreate the role by running the following command:"]}),"\n",(0,l.jsx)(t.pre,{children:(0,l.jsx)(t.code,{children:"aws cloudformation deploy --stack-name LambdaExecutionRole -template-file LambdaExecutionRole.yaml --capabilities CAPABILITY_NAMED_IAM --tags *add Key=Value tag here*\n"})}),"\n",(0,l.jsx)(t.h4,{id:"deply-cloudformation-template-using-aws-cli",children:"Deply cloudformation template using AWS CLI"}),"\n",(0,l.jsx)(t.p,{children:"Using the OCPInstall role arn, run the following command to start the main cloudformation deployment:"}),"\n",(0,l.jsx)(t.pre,{children:(0,l.jsx)(t.code,{children:"aws cloudformation deploy --stack-name stack-deployment-1 --template-file cluster.yaml --parameter-overrides file://parameters-override.json --capabilities CAPABILITY_NAMED_IAM --tags *add Key=Value tag here* --role-arn arn:aws:iam::<ACCOUNT>:role/OCPInstall\n"})}),"\n",(0,l.jsx)(t.p,{children:"Check the AWS Console to see when the cloudformation template has progressed far enough that the bootnode is online."}),"\n",(0,l.jsx)(t.p,{children:"Using the ssh key from the Key Pair name used in parameters-override.yaml, ssh to the bootnode."}),"\n",(0,l.jsx)(t.h3,{id:"monitor",children:"Monitor"}),"\n",(0,l.jsx)(t.h4,{id:"ssh-into-bootnode",children:"SSH into bootnode"}),"\n",(0,l.jsx)(t.pre,{children:(0,l.jsx)(t.code,{children:'ssh -i "$KEYPAIR_NAME.pem" ec2-user@$BOOTNDODE_IP \n'})}),"\n",(0,l.jsx)(t.h4,{id:"monitor-the-deployment",children:"Monitor the deployment"}),"\n",(0,l.jsx)(t.p,{children:'Check what folders exist in the ec2-home directory. if "cpd-status" has not been created yet, then wait a few minutes. Once "cpd-status" directory appears, run the following command:'}),"\n",(0,l.jsx)(t.pre,{children:(0,l.jsx)(t.code,{children:"tail -f ~/cpd-status/state/deployer-state.out\n"})}),"\n",(0,l.jsx)(t.p,{children:"This command will show the log file from the cp-deployer process."})]})}function h(e={}){const{wrapper:t}={...(0,s.a)(),...e.components};return t?(0,l.jsx)(t,{...e,children:(0,l.jsx)(d,{...e})}):d(e)}}}]);