"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[1169],{7748:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>a,contentTitle:()=>r,default:()=>u,frontMatter:()=>i,metadata:()=>l,toc:()=>d});var o=t(4848),s=t(8453);const i={id:"lessons",sidebar_position:4,title:"Lessons Learned",custom_edit_url:null},r=void 0,l={id:"Transition/lessons",title:"Lessons Learned",description:"Cloudformation Template",source:"@site/docs/4-Transition/3-Lessons.mdx",sourceDirName:"4-Transition",slug:"/Transition/lessons",permalink:"/solution-wxai-aws/Transition/lessons",draft:!1,unlisted:!1,editUrl:null,tags:[],version:"current",sidebarPosition:4,frontMatter:{id:"lessons",sidebar_position:4,title:"Lessons Learned",custom_edit_url:null},sidebar:"tutorialSidebar",previous:{title:"Transition",permalink:"/solution-wxai-aws/transition"}},a={},d=[{value:"Cloudformation Template",id:"cloudformation-template",level:2},{value:"Functions in Cloudformation Templates",id:"functions-in-cloudformation-templates",level:4},{value:"Bootnode Subnet",id:"bootnode-subnet",level:5}];function c(e){const n={code:"code",h2:"h2",h4:"h4",h5:"h5",li:"li",ol:"ol",p:"p",pre:"pre",...(0,s.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.h2,{id:"cloudformation-template",children:"Cloudformation Template"}),"\n",(0,o.jsx)(n.h4,{id:"functions-in-cloudformation-templates",children:"Functions in Cloudformation Templates"}),"\n",(0,o.jsx)(n.p,{children:"The following code was originally included in the Cloudformation template, however we discovered that it was formatted in a way to caused errors and prevented the creation of the stack:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"  SubnetsInVPC:\n    Assertions:\n      - Assert: !EachMemberIn\n          - !ValueOfAll\n            - AWS::EC2::Subnet::Id\n            - VpcId\n          - !RefAll 'AWS::EC2::VPC::Id'\n        AssertDescription: All subnets must in the VPC      \n"})}),"\n",(0,o.jsxs)(n.p,{children:["To fix this, we replaced the shortcut for a function which is an explamation point ",(0,o.jsx)(n.code,{children:"!"}),",  with an explicit function denoted as ",(0,o.jsx)(n.code,{children:"FN::"}),". This is the updated code:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"  SubnetsInVPC:\n    Assertions:\n    - Assert:\n        Fn::EachMemberIn:\n        - Fn::ValueOfAll:\n          - AWS::EC2::Subnet::Id\n          - VpcId\n        - Fn::RefAll: AWS::EC2::VPC::Id\n      AssertDescription: All subnets must in the VPC\n"})}),"\n",(0,o.jsx)(n.h5,{id:"bootnode-subnet",children:"Bootnode Subnet"}),"\n",(0,o.jsx)(n.p,{children:"When we ran the Cloudformation template, we were given an error message:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"No default VPC for this user. GroupName is only supported for EC2-Classic and default VPC.\n"})}),"\n",(0,o.jsxs)(n.p,{children:["This error was a by-product of running the template without any Public subnets attached. The code block below shows that the boot node requires a public subnet for the ",(0,o.jsx)(n.code,{children:"SubnetID"}),"."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"      IamInstanceProfile: !Ref BootnodeInstanceProfile\n      Tags:\n        - Key: Name\n          Value: \n            !Sub\n            - \"${ClusterName}-bootnode\"\n            - ClusterName: !Ref ClusterName \n      InstanceType: t3.large \n      NetworkInterfaces:\n      - GroupSet:\n        - !Ref BootnodeSecurityGroup\n        AssociatePublicIpAddress: true\n        DeviceIndex: '0'\n        DeleteOnTermination: true\n        SubnetId: !Ref PublicSubnet1ID  \n      UserData:\n"})}),"\n",(0,o.jsx)(n.p,{children:"There are two ways to resolve this problem:"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsx)(n.li,{children:"Use public subnets when creating the stack\nor"}),"\n",(0,o.jsxs)(n.li,{children:["Replace ",(0,o.jsx)(n.code,{children:"SubnetId: !Ref PublicSubnet1ID"}),"  with a private subnetID ",(0,o.jsx)(n.code,{children:"SubnetId: subnet-example5b646"})]}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(c,{...e})}):c(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>r,x:()=>l});var o=t(6540);const s={},i=o.createContext(s);function r(e){const n=o.useContext(i);return o.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:r(e.components),o.createElement(i.Provider,{value:n},e.children)}}}]);